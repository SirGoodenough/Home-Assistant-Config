- binary_sensor:
    #####################################################
    # Weather                                           #
    #####################################################
    - name: "Dark Outside"
      unique_id: ce7cb6b7-c666-494b-aa3c-4ed79b2f1092
      state: >
        {# Create a dead zone to prevent oscillations. #}
        {%- if states('sensor.gw2000b_v2_2_4_solar_lux') | float(0) > 7004 %}
          false
        {%- elif states('sensor.gw2000b_v2_2_4_solar_lux') | float(0) < 6507 %}
          true
        {% else %}
          {{ states('binary_sensor.dark_outside') }}
        {%- endif %}
      availability: >-
        {% from 'availability_template.jinja' import avail %}
        {{- avail(['sensor.gw2000b_v2_2_4_solar_lux']) | bool -}}
      icon: mdi:sun-clock
      attributes:
        friendly_name: "Dark Outside"

    - name: "AC Enabled"
      unique_id: f885f9fd-b280-439b-81f0-3fdd713393f5
      state: >-
        {% if (
          states('weather.home') | is_defined ) and
          states('weather.home.attributes.temperature') | is_defined %}
            {% set temp = 'weather.home.attributes.temperature' | int( 49 ) %}
            {% if ( temp > 50 ) %}
              true
            {% else %}
              false
            {% endif %}
        {% else %}
          true
        {% endif %}
        {# This is using the MET integration for weather. Available conditions #}
        {# https://github.com/home-assistant/core/blob/70648d6e3b42bb0910e33e5c6a4e1e8c0789d82c/homeassistant/components/met/const.py #}
      availability: >-
        {% from 'availability_template.jinja' import avail %}
        {{- avail(['weather.home.attributes.temperature']) | bool -}}
      icon: mdi:snowflake-alert
      attributes:
        friendly_name: "AC Enabled"


    #####################################################
    # Bat Printer State                                 #
    #####################################################
    - name: "Bambu Running"
      unique_id: 32176e45-2581-4521-b7e5-f8c31454311f
      state: >-
        {# Set the variable. #}
        {% set bambu = states('sensor.p1s_01p00c4c2100641_print_status') %}
        {% set hot = ["pause", "prepare", "running"] | list %}
        {%- if bambu in hot %}
          on
        {%- else %}
          off
        {%- endif %}
      availability: >-
        {% from 'availability_template.jinja' import avail %}
        {{- avail([ 'sensor.p1s_01p00c4c2100641_print_status' ]) | bool -}}
      attributes:
        friendly_name: "Bambino Running"
      icon: |
        {# Flip sensor for better visual state. #}
        {% if this.state %}
          mdi-printer-3d-nozzle-heat-outline
        {% elif not this.state %}
          mdi-printer-3d-nozzle-off-outline
        {% else %}
          mdi-printer-3d-nozzle-alert-outline
        {% endif %}




  # - name: 'Dark Outside'
  #   unique_id: ce7cb6b7-c666-494b-aa3c-4ed79b2f1092
  #   state: >-
  #     {% if (
  #       states('sensor.openweathermap_cloud_coverage') | is_defined ) %}
  #         {% set elev = state_attr("sun.sun", "elevation") | int(0) %}
  #         {% set cloud = 'sensor.cloud_cover_average' | float(100) %}
  #         {% if ( elev < 6 ) %}
  #           true
  #         {% elif ( elev < 10 and cloud > 51 ) %}
  #           true
  #         {% elif ( elev < 15 and cloud > 73 ) %}
  #           true
  #         {% elif ( elev > 14 and cloud > 88 ) %}
  #           true
  #         {% else %}
  #           false
  #         {% endif %}
  #     {% else %}
  #       true
  #     {% endif %}
  #     {# This is using openweathermap integration for weather & t-sma Filter. #}
  #     {# https://www.home-assistant.io/integrations/openweathermap #}
  #     {# https://www.home-assistant.io/integrations/filter/#time-simple-moving-average #}
  #   availability: >-
  #     {% from 'availability_template.jinja' import avail %}
  #     {{- avail(['sun.sun','sensor.openweathermap_cloud_coverage','sensor.cloud_cover_average']) | bool -}}
  #   icon: mdi:sun-clock
  #   attributes:
  #     friendly_name: "Dark Outside"
