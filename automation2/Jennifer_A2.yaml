---
#####################################################
# Jens Flush Automation                             #
#####################################################
- id: "fea42729-2c84-442a-9104-dbd6148c2e17"
  mode: single
  alias: FlushTimer
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.flush2
      from: "off"
      to: "on"
  action:
    - alias: Start the first Timer and play first message then wait for timer to end
      service: timer.start
      entity_id: timer.flushtime2
    - service: media_player.volume_set
      data:
        entity_id: media_player.jen_group
        volume_level: .8
    - service: script.tts_first_flush
    - wait_for_trigger:
        - platform: event
          event_type: timer.finished
          event_data:
            entity_id: timer.flushtime2

    - alias: Gong the end of the first timer
      service: media_player.play_media
      data:
        entity_id: media_player.jen_group
        media_content_id: 
          "media-source://media_source/local/mp3/Metal_Gong-Dianakc-109711828.mp3"
        media_content_type: audio/mp3

    - delay: 00:00:57 # Delay for the second part first warning

    - alias: notify the middle of the delay
      service: script.tts_middle_flush

    - delay: 00:01:01 # Delay for the second part rest of the delay

    - alias: Start the last Timer and play last message then wait for timer to end
      service: timer.start
      entity_id: timer.flushtime10
    - service: script.tts_final_flush
    - wait_for_trigger:
        - platform: event
          event_type: timer.finished
          event_data:
            entity_id: timer.flushtime10

    - alias: Gong the end of the last timer
      service: media_player.play_media
      data:
        entity_id: media_player.jen_group
        media_content_id: 
          "media-source://media_source/local/mp3/Metal_Gong-Dianakc-109711828.mp3"
        media_content_type: audio/mp3
    - service: input_boolean.turn_off
      entity_id: input_boolean.flush2
    - delay: 00:00:06
    - alias: Reset jens speaker to volume 5
      service: media_player.volume_set
      data:
        entity_id: media_player.jennys_room_display
        volume_level: .5

#####################################################
# Jens Mister                                       #
#####################################################
- id:
    188ccb1a-9ab3-453e-8910-7d6f7a7ca9ea
    # Let everyone know a refill is required.
  alias: Jens Neb Announcement
  initial_state: on
  trigger:
    - platform: state
      entity_id: binary_sensor.aromatherapy_water
      from: "off"
      to: "on"
    - platform: state
      entity_id: input_boolean.mist_button
      from: "off"
      to: "on"
  action:
    - alias: Out of water in Mister
      service: input_boolean.turn_off
      entity_id: input_boolean.mist_button
    - service: script.tts_mister_message
    - delay: 00:00:10
    - service: media_player.play_media
      data:
        entity_id: media_player.kitchen_speaker
        media_content_id: 
          "media-source://media_source/local/mp3/Mister.mp3"
        media_content_type: audio/mp3

- id: bc67a0b5-846f-41df-b0fb-cc1c8a8b714b
  alias: Jen Message List
  mode: single
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_select.jens_alert_list_1
      id: all
    - platform: state
      entity_id: input_select.no_bedroom_help
      id: no_bedroom
    - platform: state
      entity_id: input_select.phone_help
      id: phone
  condition:
    condition: or
    conditions:
      - "{{ trigger.to_state.state != '' }}"
      - "{{ trigger.to_state.state != 'off' }}"
  action:
    - service: input_select.select_option
      target:
        entity_id:
          - input_select.jens_alert_list_1
          - input_select.no_bedroom_help
          - input_select.phone_help
      data:
        option: "off"
    - choose:
        - alias: Message to all speakers
          conditions:
            - condition: trigger
              id: all
          sequence:
            service: script.jen_needs_help
            data:
              message: "{{ trigger.to_state.state }}"
              entities:
                - media_player.common_group
                - media_player.living_room_speaker
                - media_player.bedroom_speaker
        - alias: Message to all speakers except bedroom
          conditions:
            - condition: trigger
              id: no_bedroom
          sequence:
            service: script.jen_needs_help
            data:
              message: "{{ trigger.to_state.state }}"
              entities: 
                - media_player.common_group
                - media_player.living_room_speaker
        - alias: Message to Mom & Dads Phone
          conditions:
            - condition: trigger
              id: phone
          sequence:
            service: script.jen_needs_help_level2_template
            data:
              message: "{{ trigger.to_state.state }}"
