---
- id: "fea42729-2c84-442a-9104-dbd6148c2e17"
  mode: single
  alias: FlushTimer
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.flush2
      from: "off"
      to: "on"
  action:
    - service: timer.start
      entity_id: timer.flushtime2
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.kitchen_display, media_player.nesthub0502
        volume_level: .8
    - service: tts.cloud_say
      data_template:
        entity_id: media_player.kitchen_display, media_player.nesthub0502
        message: >
          {{ ("I'm a cowboy, on a steel horse I ride",
              "I'm a cowboy, I got the night on my side", 
              "I'm wanted, wanted. Dead or alive", 
              "I drive all night just to get back home", 
              "Another place, where the faces are so cold", 
              "Everyday it seems we are wasting away", 
              "Its all the same. Only the names will change"
              ) |random }}
        options:
          gender: female
        language: en-US
    - wait_for_trigger:
        - platform: event
          event_type: timer.finished
          event_data:
            entity_id: timer.flushtime2
    - service: media_player.play_media
      data:
        entity_id: media_player.kitchen_display, media_player.nesthub0502
        media_content_id: !secret Gong
        media_content_type: audio/mp3

    - delay: 00:00:57 # Delay for the second part first warning
    - service: tts.cloud_say
      data:
        entity_id: media_player.kitchen_display, media_player.nesthub0502
        message: "Woah, we're halfway there.  Woah, livin' on a prayer"
        options:
          gender: female
        language: en-US
    - delay: 00:01:01 # Delay for the second part rest of the delay

    - service: timer.start
      entity_id: timer.flushtime5
    - service: tts.cloud_say
      data_template:
        entity_id: media_player.kitchen_display, media_player.nesthub0502
        message: >
          {{ ("This ain't a song for the broken-hearted",
              "No silent prayer for faith-departed",
              "And I ain't gonna be just a face in the crowd",
              "You're gonna hear my voice when I shout it out loud"
              ) |random }}
        options:
          gender: female
        language: en-US
    - wait_for_trigger:
        - platform: event
          event_type: timer.finished
          event_data:
            entity_id: timer.flushtime5
    - service: media_player.play_media
      data:
        entity_id: media_player.kitchen_display, media_player.nesthub0502
        media_content_id: !secret Gong
        media_content_type: audio/mp3
    - service: input_boolean.turn_off
      entity_id: input_boolean.flush2
    - delay: 00:00:04
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.nesthub0502
        volume_level: .5
