---
#####################################################
# Jens Flush Automation                             #
#####################################################
- id: "fea42729-2c84-442a-9104-dbd6148c2e17"
  mode: single
  alias: FlushTimer
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.flush2
      from: "off"
      to: "on"
  action:
    - service: timer.start
      entity_id: timer.flushtime2

    - service: media_player.volume_set
      data:
        entity_id: media_player.kitchen_speaker, media_player.jennys_room_display
        volume_level: .8

    - service: tts.cloud_say
      data:
        entity_id: media_player.kitchen_speaker, media_player.jennys_room_display
        message: >
          {{ ("It's all the same, only the names will change",
              "Every day, it seems we're wastin' away", 
              "Another place, where the faces are so cold", 
              "I'd drive all night just to get back home", 
              "I'm a cowboy. On a steel horse I ride. I'm wanted. Dead or alive", 
              "Sometimes I sleep, sometimes, it's not for days", 
              "The people I meet always go their separate ways",
              "Sometimes you tell the day by the bottle that you drink",
              "And times when you're alone, well, all you do is think",
              "Oh, and I ride.  Yeah.",
              "And I walk these streets. A loaded six-string on my back",
              "I play for keeps. 'Cause I might not make it back",
              "I've been everywhere. Still I'm standing tall",
              "I've seen a million faces and I've rocked them all",
              "And I'm wanted. (wanted). dead or alive",
              "And I ride. (and I ride). dead or alive",
              "I still drive. (I still drive). dead or alive"
              ) |random }}
        options:
          gender: female
        language: en-US

    - wait_for_trigger:
        - platform: event
          event_type: timer.finished
          event_data:
            entity_id: timer.flushtime2

    - service: media_player.play_media
      data:
        entity_id: media_player.kitchen_speaker, media_player.jennys_room_display
        media_content_id: !secret Gong
        media_content_type: audio/mp3

    - delay: 00:00:57 # Delay for the second part first warning

    - service: tts.cloud_say
      data:
        entity_id: media_player.kitchen_speaker, media_player.jennys_room_display
        message: >
          {{ ("So close, no matter how far",
              "Couldn't be much more from the heart",
              "Forever trusting who we are",
              "And nothing else matters",
              "Never opened myself this way",
              "Life is ours, we live it our way",
              "All these words, I don't just say",
              "Trust I seek and I find in you",
              "Every day for us something new",
              "Open mind for a different view",
              "Never cared for what they do",
              "Never cared for what they know",
              "But I know",
              "It couldn't be much more from the heart",
              "I never opened myself this way",
              "Never cared for what they say",
              "Never cared for games they play",
              "And I know, yeah, yeah"
              ) |random }}
        options:
          gender: male
        language: >
          {{ ("en-GB",
              "en-US",
              "en-AU"
              ) |random }}

    - delay: 00:01:01 # Delay for the second part rest of the delay

    - service: timer.start
      entity_id: timer.flushtime5

    - service: tts.cloud_say
      data:
        entity_id: media_player.kitchen_speaker, media_player.jennys_room_display
        message: >
          {{ ("This ain't a song for the broken-hearted",
              "No silent prayer for faith-departed",
              "And I ain't gonna be just a face in the crowd",
              "You're gonna hear my voice when I shout it out loud",
              "It's my life.",
              "But I ain't gonna live forever.",
              "I just want to live while I'm alive",
              "My heart is like an open highway",
              "Like Frankie said, I did it my way",
              "It's now or never.",
              "Yeah, this is for the ones who stood their ground",
              "For Tommy and Gina, who never backed down",
              "Tomorrow's getting harder, make no mistake",
              "Luck ain't even lucky, got to make your own breaks"
              ) |random }}
        options:
          gender: female
        language: en-US

    - wait_for_trigger:
        - platform: event
          event_type: timer.finished
          event_data:
            entity_id: timer.flushtime5

    - service: media_player.play_media
      data:
        entity_id: media_player.kitchen_speaker, media_player.jennys_room_display
        media_content_id: !secret Gong
        media_content_type: audio/mp3

    - service: input_boolean.turn_off
      entity_id: input_boolean.flush2

    - delay: 00:00:04

    - service: media_player.volume_set
      data:
        entity_id: media_player.jennys_room_display
        volume_level: .5

#####################################################
# Jens Mister                                       #
#####################################################
- id:
    188ccb1a-9ab3-453e-8910-7d6f7a7ca9ea
    # Let everyone know a refill is required.
  alias: Jens Neb Announcement
  initial_state: on
  trigger:
    - platform: state
      entity_id: binary_sensor.aromatherapy_water
      from: "off"
      to: "on"
    - platform: state
      entity_id: input_boolean.mist_button
      from: "off"
      to: "on"
  action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.mist_button
    - service: tts.cloud_say
      data:
        entity_id: media_player.kitchen_speaker, media_player.living_room_speaker, media_player.jennys_room_display
        message: "No juice in the Bucket, mate.  Time to add the Vegemite."
        options:
          gender: male
        language: en-AU
    - delay: 00:00:08
    - service: media_player.play_media
      data:
        entity_id: media_player.kitchen_speaker, media_player.jennys_room_display, media_player.office_jamz, media_player.garage_speaker, media_player.basement_speaker
        media_content_id: !secret Mister
        media_content_type: audio/mp3

- id: bc67a0b5-846f-41df-b0fb-cc1c8a8b714b
  alias: Jen Message List
  mode: single
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_select.jens_alert_list_1
      id: all
    - platform: state
      entity_id: input_select.no_bedroom_help
      id: no_bedroom
    - platform: state
      entity_id: input_select.phone_help
      id: phone
  condition:
    condition: or
    conditions:
      - "{{ trigger.to_state.state != '' }}"
      - "{{ trigger.to_state.state != 'off' }}"
  action:
    - service: input_select.select_option
      target:
        entity_id:
          - input_select.jens_alert_list_1
          - input_select.no_bedroom_help
          - input_select.phone_help
      data:
        option: "off"
    - choose:
        - alias: Message to all speakers
          conditions:
            - condition: trigger
              id: all
          sequence:
            service: script.jen_needs_help
            data:
              message: "{{ trigger.to_state.state }}"
              entities:
                - group.intercom_stack
                - media_player.bedroom_speaker
        - alias: Message to all speakers except bedroom
          conditions:
            - condition: trigger
              id: no_bedroom
          sequence:
            service: script.jen_needs_help
            data:
              message: "{{ trigger.to_state.state }}"
              entities: group.intercom_stack
        - alias: Message to Mom & Dads Phone
          conditions:
            - condition: trigger
              id: phone
          sequence:
            service: script.jen_needs_help_level2_template
            data:
              message: "{{ trigger.to_state.state }}"
