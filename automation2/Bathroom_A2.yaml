---
#####################################################
# Bathroom                                          #
#####################################################
- id: d0cbe0e5-10cb-407f-a535-6aaa3146f91a
  alias: Bathroom Heat Failsafe
  initial_state: on
  trigger:
    - platform: state
      entity_id: switch.aeotec_dsc26103_micro_switch_2nd_edition_switch
      to: "on"
  action:
    - service: script.upstairs_bath_heater_watchdog
    - service: script.tts_bathroom_heat_on

- id: 2d1ec212-0443-44c6-883b-85757c900e92
  alias: Bathroom is Overheated
  initial_state: on
  trigger:
    platform: numeric_state
    entity_id: sensor.bathoom_si7021_temperature
    above: 85
  condition:
    condition: state
    entity_id: switch.aeotec_dsc26103_micro_switch_2nd_edition_switch
    state: "on"
  action:
    - service: script.upstairs_bath_heater_off
    - service: script.media_player_bathroom
    - delay: 00:00:06
    - service: script.tts_for_bathroom_overheat

- id: bd61ef61-ae56-47ae-9902-6166657aceac
  alias: Bathroom Door is Open
  initial_state: on
  trigger:
    platform: state
    entity_id: switch.aeotec_dsc26103_micro_switch_2nd_edition_switch
    to: "on"
    for:
      seconds: 120
  condition:
    condition: state
    entity_id: binary_sensor.bathroom
    state: "on"
  action:
    - service: script.upstairs_bath_heater_off
    - service: script.media_player_bathroom
    - delay: 00:00:06
    - service: script.tts_bathroom_door_is_open

- id: 4d6bdbcb-b71d-4d3a-b52e-19ab077b9585
  alias: Bathroom Heater Auto Mode
  initial_state: on
  trigger:
    - platform: state
      entity_id: input_boolean.bathroom_heater_auto_on
      to: "on"
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: person.julie
        state: "Home"
      - condition: numeric_state
        entity_id: sensor.dark_sky_apparent_temperature
        below: 40
  action:
    - service: script.upstairs_bath_heater_on
    - service: script.tts_bathroom_heat_on
    - service: input_boolean.turn_off
      entity_id: input_boolean.bathroom_heater_auto_on

- id: a152e88d-6c9c-42bd-9a62-15ecb7745e29
  alias: Bathroom Heater Julie Bedtime
  initial_state: on
  trigger:
    - platform: time
      at: "21:22:37"
  action:
    - service: input_boolean.turn_on
      entity_id: input_boolean.bathroom_heater_auto_on

- id: c61050df-d8b7-46db-9150-7137cf6f3b92
  alias: Silence Bathroom Speaker
  initial_state: on
  mode: restart
  trigger:
    - platform: state
      entity_id: binary_sensor.stairs_up
      to: "on"
    - platform: state
      entity_id: button.stairs_up
  action:
    - alias: Mute bathroom
      service: script.google_mute
      data:
        status: true
        entities: media_player.bathroom_speaker, media_player.bedroom_speaker
    - delay: 04:00:00
    - alias: Unmute bathroom
      service: script.google_mute
      data:
        status: false
        entities: media_player.bathroom_speaker, media_player.bedroom_speaker
